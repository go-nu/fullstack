<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ìƒí’ˆ ìƒì„¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Stardos+Stencil:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div>
    <h2 th:text="${product.name}">ìƒí’ˆ ì´ë¦„</h2>
    <p th:text="${product.description}">ìƒí’ˆ ì„¤ëª…</p>

    <!-- ì´ë¯¸ì§€ ì—¬ëŸ¬ ì¥ ì§€ì› (ì¸ë„¤ì¼/ë¦¬ìŠ¤íŠ¸) -->
    <div th:if="${product.images != null && #lists.size(product.images) > 0}">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <img th:each="img : ${product.images}" th:src="${img.imageUrl}" alt="ìƒí’ˆ ì´ë¯¸ì§€" width="200"
                 style="border:1px solid #ccc; border-radius:8px;"/>
        </div>
    </div>
    <div th:if="${product.images == null || #lists.size(product.images) == 0}">
        <p>ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ì˜µì…˜/ëª¨ë¸ ì…€ë ‰íŠ¸ ë°•ìŠ¤ -->
    <h4>ëª¨ë¸/ì˜µì…˜ ì„ íƒ</h4>
    <select id="modelSelect" class="form-select" style="max-width:300px;">
        <option value="">ì˜µì…˜ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option th:each="model : ${product.productModels}"
                th:value="${model.id}"
                th:data-price="${model.price}"
                th:data-stock="${model.prStock}"
                th:text="|${model.productModelSelect} / ${#numbers.formatInteger(model.price, 3, 'COMMA')}ì› / ì¬ê³ :${model.prStock}|">
        </option>
    </select>
    <div id="modelInfo" style="margin-top:10px;"></div>

    <!-- ì°œ/ì¥ë°”êµ¬ë‹ˆ/êµ¬ë§¤ Form -->
    <form th:action="@{/wishlist/toggle}" method="post" id="productForm">
        <input type="hidden" id="productId" name="productId" th:value="${product.id}" />
        <input type="hidden" id="actionType" name="actionType" value="cart" />
        <button type="submit" th:text="${product.liked} ? 'ì°œ ì·¨ì†Œ' : 'ì°œí•˜ê¸°'"></button>

        <div>
            <div>ìˆ˜ëŸ‰</div>
            <input type="number" name="count" id="count" value="1" min="1"/>
        </div>

        <div>
            <button type="button" onclick="submitForm('cart')">ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€</button>
            <button type="button" onclick="submitForm('buy')">êµ¬ë§¤í•˜ê¸°</button>
        </div>
    </form>

    <div>
        <div>
            <input type="hidden" id="price" name="price" />
            <span id="selectedPrice">0</span>ì›
        </div>
        <div>
            <h5>ê²°ì œ ê¸ˆì•¡</h5>
            <h3 name="totalPrice" id="totalPrice"></h3>
        </div>
    </div>
    <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼: ì‘ì„±ìë§Œ ë³´ì´ê²Œ -->
    <div th:if="${loginUser != null and product.writerId == loginUser.id}">
        <form th:action="@{'/products/' + ${product.id} + '/edit'}" method="get" style="display:inline;">
            <button type="submit">ìˆ˜ì •</button>
        </form>
        <form th:action="@{'/products/' + ${product.id} + '/delete'}" method="post" style="display:inline;">
            <button type="submit">ì‚­ì œ</button>
        </form>
    </div>

    <!-- ğŸ”™ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° (í•­ìƒ í‘œì‹œ) -->
    <div style="margin-top: 20px;">
        <a th:href="@{/products}">
            <button type="button">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </a>
    </div>
</div>

<!-- ë¦¬ë·°/QnA íƒ­ ì‚½ì… ì˜ì—­ -->
<div id="tab-section-placeholder"></div>

<div class="mt-5">
    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tab-menu d-flex mb-3 border-bottom">
        <button class="btn btn-link me-3 tab-button active" data-target="review-section">ë¦¬ë·°</button>
        <button class="btn btn-link tab-button" data-target="qna-section">Q&A</button>
    </div>

    <!-- ë¦¬ë·° ì˜ì—­ -->
    <div id="review-section" class="tab-content-section">
        <div th:replace="~{review/review :: reviewboard}"></div>
    </div>

    <!-- Qna ì˜ì—­ -->
    <div id="qna-section" class="tab-content-section" style="display: none;">
        <div  id="qna-content" th:replace="~{qna/qna :: qnaboard}"></div>
    </div>
</div>

<div th:replace="~{index/footer :: footer}"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/product/detail.js" defer></script>
<script>
    // ì˜µì…˜ ì„ íƒ ì‹œ ê°€ê²©/ì¬ê³  í‘œì‹œ ë° ê²°ì œ ê¸ˆì•¡ ë™ì  ê³„ì‚°
    document.addEventListener('DOMContentLoaded', function() {
        const modelSelect = document.getElementById('modelSelect');
        const selectedPriceSpan = document.getElementById('selectedPrice');
        const countInput = document.getElementById('count');
        const totalPrice = document.getElementById('totalPrice');

        function updatePriceAndTotal() {
            const selected = modelSelect.selectedOptions[0];
            let price = 0;
            if(selected && selected.dataset.price) {
                price = parseInt(selected.dataset.price);
                selectedPriceSpan.innerText = price.toLocaleString();
                document.getElementById('price').value = price;
            } else {
                selectedPriceSpan.innerText = '0';
            }
            const count = parseInt(countInput.value) || 1;
            totalPrice.innerText = (price * count).toLocaleString() + 'ì›';
        }
        modelSelect.addEventListener('change', updatePriceAndTotal);
        countInput.addEventListener('input', updatePriceAndTotal);
        // ìµœì´ˆ ë¡œë”© ì‹œ ê²°ì œ ê¸ˆì•¡ í‘œì‹œ
        updatePriceAndTotal();
    });
</script>
<script src="/js/review/review.js" defer></script>
<script src="/js/qna/qna.js" defer></script>
</body>
</html>
